%%
clear
clc
sample_x = [50,100,300,380,400];
sample_y = [50,300,100,200,400];
sample_size = size(sample_x);

n = sample_size(2);
d = 3;
resolution = 0.01;

t = resolution:resolution:(n+d-1);

u = [0,1,2,3,4,5,6,7];
[curve_x,curve1_x,curve2_x,B3_x] = B_spline(sample_x,n,d,u,resolution,'uniform');
[curve_y,curve1_y,curve2_y,B3_y] = B_spline(sample_y,n,d,u,resolution,'uniform');
subplot(2,2,1);
plot(t,curve2_x(1,:),t,curve2_x(2,:),t,curve2_x(3,:),t,curve2_x(4,:));
subplot(2,2,2);
plot(t,curve1_x(1,:),t,curve1_x(2,:),t,curve1_x(3,:),t,curve1_x(4,:),t,curve1_x(5,:),t,curve1_x(6,:));
subplot(2,2,3);
plot(curve_x(201:500),curve_y(201:500),sample_x,sample_y,'ro')
subplot(2,2,4);
plot(curve_x,curve_y,sample_x,sample_y,'ro')


%%

%%
clear
clc
% sample_x = [50,100,300,380,400];
% sample_y = [50,300,100,200,400];
sample_x = [0,-0.0852025374770165,-0.446904689073563,-0.341821014881134,-0.409289628267288,-0.448709517717361,-0.812631428241730,-1.04296457767487,-1.18727779388428,-1.27184498310089,-1.44754815101624,-1.70562005043030,-1.43677067756653,-1.17731928825378,-0.991224706172943,-0.669041693210602,0.800000011920929,1.04188370704651,1.41674482822418,1.73923242092133,2.09486055374146,2.49328804016113,2.82800650596619,3.07680296897888,3.46804285049438,4.40000009536743,4.70370292663574,5.00740575790405,5.31110858917236,5.61481142044067,5.91851425170898,6.22221708297730,6.52591943740845,6.82962226867676,7.13332509994507,7.43702745437622,7.74072980880737,8.04443264007568,8.34813499450684,8.65183734893799,10];
sample_y = [0,-0.390820324420929,-0.561617195606232,-0.947567224502564,-1.34183621406555,-1.73988902568817,-1.90590357780457,-2.23293042182922,-2.60599040985107,-2.99694871902466,-3.35629320144653,-3.66190552711487,-3.95808124542236,-4.26252317428589,-4.61659765243530,-4.85365915298462,-5,-5.31857872009277,-5.45814609527588,-5.69479322433472,-5.87790155410767,-5.91333580017090,-6.13234186172485,-6.44555139541626,-6.52880573272705,-4.80000019073486,-4.53968381881714,-4.27936744689941,-4.01905107498169,-3.75873446464539,-3.49841785430908,-3.23810124397278,-2.97778463363647,-2.71746802330017,-2.45715141296387,-2.19683480262756,-1.93651819229126,-1.67620158195496,-1.41588497161865,-1.15556836128235,0];
sample_size = size(sample_x);

n = sample_size(2);
d = 3;
resolution = 0.001;

t = resolution:resolution:(n-d+1)/10;

u = [0 0];
for i=1:40
    u(i+2) = (i-1)*0.1; 
end
u(i+3) = u(i+2);
u(i+4) = u(i+2);

[curve_x,curve1_x,curve2_x,B3_x] = B_spline(sample_x,n,d,u,resolution,'quasi-uniform');
[curve_y,curve1_y,curve2_y,B3_y] = B_spline(sample_y,n,d,u,resolution,'quasi-uniform');

subplot(2,2,1);
plot(t,curve2_x(1,:),t,curve2_x(2,:),t,curve2_x(3,:),t,curve2_x(4,:),t,curve2_x(5,:));
subplot(2,2,2);
for i=1:39
    plot(t,curve1_x(i,:));
    hold on
end
title('一阶基函数');
subplot(2,2,3);
plot(curve_x,curve_y,sample_x,sample_y,'ro')
subplot(2,2,4);
title('二阶基函数');
for i=1:41
    plot(t,curve2_x(i,:));
    hold on
end
title('二阶基函数');

%%

%%

% %%
% clear
% clc
% syms u uk ukd_1 ukd uk1 ak1 bk1 ak2 bk2 ak11 bk11 ak12 bk12
% 
% Bkd = (u-uk)/(ukd_1-uk)*(ak1*u+bk1)
% simplify(Bkd)

%%